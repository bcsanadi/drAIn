<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>drAIn - Deplete</title>
  <link rel="stylesheet" href="/static/css/style.css">
</head>

<body>
  <!-- Navigation bar -->
  <nav class="nav-bar">
    <div class="nav-container">
      <a href="/home" class="logo-text">drAIn</a>
      <div class="nav-buttons">
        <a href="/refill" class="nav-button1">Refill</a>
        <a href="/deplete" class="deplete-button">Deplete</a>
        <a href="/logout" class="nav-button2">Logout</a>
      </div>
    </div>    
  </nav>

  <!-- Chatbot content -->
  <main style="flex: 1; display: flex; justify-content: center; align-items: center; padding: 2rem;">
    <section class="chat-card" aria-label="AI Chatbot">
      <div class="chat-header">drAIn Chatbot</div>

      <div id="chatlog" class="chat-log">
        <div class="msg bot"><div class="bubble">Hi! How can I help you today?</div></div>
      </div>

      <form id="chat-form" class="chat-form" autocomplete="off">
        <input id="chat-input" class="chat-input" type="text" placeholder="Type your message..." required />
        <button id="chat-send" class="chat-send" type="submit">Send</button>
      </form>
    </section>
  </main>

  <!-- Footer -->
  <footer>
    <div class="footer-content">
      <p>Created with ðŸ©µ by Scrumpty Dumpty</p>
    </div>
  </footer>


  <script>
  (() => {
    const API = "http://127.0.0.1:5003/chat"; // local Flask endpoint
    const log = document.getElementById("chatlog");
    const form = document.getElementById("chat-form");
    const input = document.getElementById("chat-input");
    const sendBtn = document.getElementById("chat-send");


    const history = [];


    function addMessage(who, text) {
      const wrap = document.createElement("div");
      wrap.className = `msg ${who}`;
      const bubble = document.createElement("div");
      bubble.className = "bubble";
      bubble.textContent = text;
      wrap.appendChild(bubble);
      log.appendChild(wrap);
      log.scrollTop = log.scrollHeight;
    }


    form.addEventListener("submit", async (e) => {
      e.preventDefault();
      const text = input.value.trim();
      if (!text) return;
      addMessage("user", text);
      input.value = "";
      sendBtn.disabled = true;


      try {
        const res = await fetch(API, {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ message: text, messages: history })
        });
        const data = await res.json();
        const reply = data.reply || "(no response)";
        addMessage("bot", reply);


        history.push({ role: "user", content: text });
        history.push({ role: "assistant", content: reply });
        if (history.length > 10) history.splice(0, history.length - 10);
      } catch (err) {
        addMessage("bot", "Oopsâ€”network error. Make sure your Python server is running!");
      } finally {
        sendBtn.disabled = false;
      }
    });
  })();
  </script>
</body>
</html>


